<!doctype html>
<html lang="ru">
<head>
    <meta charset="utf-8">
    <title>Подтверждение бронирования - {{ session_info[4] }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/booking_confirme.css') }}">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Подтверждение бронирования</h1>
            <nav>
                <a href="{{ url_for('main.main_page') }}" class="nav-link">Главная страница</a>
                <a href="{{ url_for('all_films.all_films') }}" class="nav-link">Все фильмы</a>
                <a href="{{ url_for('user_cabinet.personal_account') }}" class="nav-link">Личный кабинет</a>
            </nav>
        </div>

        <div class="booking-details">
            <h2>{{ session_info[4] }}</h2>
            <div class="session-info">
                <p class="date">Дата: {{ session_info[1].strftime('%d.%m.%Y') }}</p>
                <p class="time">Время: {{ session_info[2].strftime('%H:%M')}}</p>
                <p class="duration">Продолжительность: {{ session_info[5] }} минут</p>
            </div>

            <div class="selected-seats">
                <h3>Выбранные места:</h3>
                <ul>
                    {% for seat in selected_seats %}
                    <li>Ряд {{ seat[1] }}, Место {{ seat[2] }}</li>
                    {% endfor %}
                </ul>
            </div>

            <div class="price-summary">
                <p class="price-per-ticket">Цена за билет: {{ session_info[3] }} ₽</p>
                <p class="total-price">Итого к оплате: {{ total_price }} ₽</p>
            </div>

            <form action="{{ url_for('booking.process_booking') }}" method="post" id="booking-form">
                <input type="hidden" name="session_id" value="{{ session_info[0] }}">
                {% for seat in selected_seats %}
                <input type="hidden" name="seat_ids" value="{{ seat[0] }}">
                {% endfor %}
                <button type="submit" class="confirm-button">Перейти к оплате</button>
            </form>
        </div>
    </div>

    <script>
        document.getElementById('booking-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const form = this;
            const formData = new FormData(form);

            console.log('Form data:');
            for (let pair of formData.entries()) {
                console.log(pair[0] + ': ' + pair[1]);
            }

            fetch(form.action, {
                method: 'POST',
                headers: {
                    'Accept': 'application/json'
                },
                body: formData
            })
            .then(response => {
                console.log('Response status:', response.status);
                if (!response.ok) {
                    throw new Error('Ошибка сервера');
                }
                return response.json();
            })
            .then(data => {
                console.log('Response data:', data);
                if (data.error) {
                    throw new Error(data.error);
                }
                if (data.redirect_url) {
                    window.location.href = data.redirect_url;
                } else {
                    throw new Error('Некорректный ответ сервера');
                    alert('Произошла ошибка при бронировании. Пожалуйста, попробуйте снова.');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Произошла ошибка. Пожалуйста, попробуйте снова.');
            });
        });
    </script>
</body>
</html> 