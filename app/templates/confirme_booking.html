<!doctype html>
<html lang="ru">
<head>
    <meta charset="utf-8">
    <title>Подтверждение бронирования - {{ session_info[4] }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/booking_confirm.css') }}">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Подтверждение бронирования</h1>
            <nav>
                <a href="{{ url_for('main.main_page') }}" class="nav-link">Главная страница</a>
                <a href="{{ url_for('all_films.all_films') }}" class="nav-link">Все фильмы</a>
                <a href="{{ url_for('user_cabinet.personal_account') }}" class="nav-link">Личный кабинет</a>
            </nav>
        </div>

        <div class="booking-details">
            <h2>{{ session_info[4] }}</h2>
            <div class="session-info">
                <p class="date">Дата: {{ session_info[1] }}</p>
                <p class="time">Время: {{ session_info[2]}}</p>
                <p class="duration">Продолжительность: {{ session_info[5] }} минут</p>
            </div>

            <div class="selected-seats">
                <h3>Выбранные места:</h3>
                <ul>
                    {% for seat in selected_seats %}
                    <li>Ряд {{ seat[1] }}, Место {{ seat[2] }}</li>
                    {% endfor %}
                </ul>
            </div>

            <div class="price-summary">
                <p class="price-per-ticket">Цена за билет: {{ session_info[3] }} ₽</p>
                <p class="total-price">Итого к оплате: {{ total_price }} ₽</p>
            </div>

            <form action="{{ url_for('booking.process_booking') }}" method="post" id="booking-form">
                <input type="hidden" name="session_id" value="{{ session_info[0] }}">
                {% for seat in selected_seats %}
                <input type="hidden" name="seat_ids" value="{{ seat[0] }}">
                {% endfor %}
                <button type="submit" class="confirm-button">Перейти к оплате</button>
            </form>
        </div>
    </div>

    <script>
        document.getElementById('booking-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const form = this;
            
            // Отправляем форму бронирования
            fetch(form.action, {
                method: 'POST',
                body: new FormData(form)
            })
            .then(response => response.json())
            .then(data => {
                if (data.booking_id) {
                    // Перенаправляем на страницу оплаты
                    window.location.href = "{{ url_for('payment.confirme_payment', booking_id='') }}" + data.booking_id;
                } else {
                    alert('Произошла ошибка при бронировании. Пожалуйста, попробуйте снова.');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Произошла ошибка. Пожалуйста, попробуйте снова.');
            });
        });
    </script>
</body>
</html> 